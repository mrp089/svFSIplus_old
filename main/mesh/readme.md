## Mesh format

**svFSI** supports multiple mesh types, such as plain text files (coordinates + connectivity), ".msh" file generated by Gambit, vtk files and NURBS meshes.

SimVascular-based vtu/vtp format for mesh/faces is the default choice. **svFSI** supports below element types in vtu/vtp format:

- line (linear, quadratic)
- triangle (linear, quadratic)
- quadrilateral (bilinear, serendipity, biquadratic)
- tetrahedron (linear, quadratic)
- hexagonal brick (trilinear, quadratic/serendipity, triquadratic)
- wedge

It is recommended to generate these mesh files using **SimVascular**. **SimVascular** GUI provides a complete pipeline that includes model construction, mesh generation, problem configuration, input file generation, and numerical simulation. Although the model construction and mesh generation have been discussed extensively in other parts of the **SimVascular** user guides, we will go over them briefly for the sake of completeness.

Let's use an idealized left ventricular model as an example. First, we create a SV Project called LV_Inflation. In cardiovascular modeling, computational models are usually generated from medical images. However, as we are using an idealized ventricular geometry here, we can directly import the model into the <code>SV Data Manager</code> by right clicking <code>Models</code> and selecting <code>Import Solid Model</code>. The solid model can be a surface mesh stored in either stl or vtp format.

<figure>
  <img class="svImg svImgMd" src="/documentation/svfsi/main/imgs/import_model.png" style="width:100%;height:auto;max-width: 30vw;">
  <figcaption class="svCaption" >Import solid model for mesh generation.</figcaption>
</figure>

We could name the new model LV. When asked if you would like to extract faces from the model, click yes and accept the default separation angle (50 degree). Oftentimes, the imported model is not centered in the field of view. One can right click on the model and click <code>Global Reinit</code> to recenter the geometry. Double click the model name to open the <code>SV Modeling</code> window and rename each face corresponding to its physiological interpretation (base - LV basal plane; endo - endocardium; epi - epicardium) and set each of these face types as wall. You may also change the color of each face to distinguish them in the Display window.

<figure>
  <img class="svImg svImgMd" src="/documentation/svfsi/main/imgs/faces.png" style="width:100%;height:auto;max-width: 30vw;">
  <figcaption class="svCaption" >Extract faces from the imported model.</figcaption>
</figure>

Next we will generate an unstructured mesh from this idealized LV model. In the <code>SV Data Manager</code>, right click <code>Meshes</code> and select <code>Create Mesh</code>. Accepting the default options will create a mesh object named LV. Double click the mesh object to open the <code>SV Meshing</code> configuration window. The most import parameter here is <code>Global Max Edge Size</code>, which controls the size of the elements. We will set this value to 2.0 and run the mesher. A relatively coarse mesh will be generated. Users can reduce the <code>Global Max Edge Size</code> if a finer mesh is desired.

<figure>
  <img class="svImg svImgMd" src="/documentation/svfsi/main/imgs/Mesher.png" style="width:100%;height:auto;max-width: 30vw;">
  <figcaption class="svCaption" >Meshing configuration.</figcaption>
</figure>

To convert the generated mesh to the svFSI-ready format, right click the mesh object, LV, and select <code>Export Mesh Complete</code>.

<figure>
  <img class="svImg svImgMd" src="/documentation/svfsi/main/imgs/export_mesh.png" style="width:100%;height:auto;max-width: 30vw;">
  <figcaption class="svCaption" >Export the complete mesh.</figcaption>
</figure>

Open the destination folder to find the mesh files contained in a folder called \<mesh object name\>-mesh-complete (LV-mesh-complete in this case). In this folder, the vtu file (mesh-complete.mesh.vtu) contains the volume mesh of the ventricle. The surface (boundary) mesh files could be found in the subfolder mesh-surfaces in vtp format. This set of vtk files defines the computational domain of this problem and can be visualized in Paraview.

<figure>
  <img class="svImg svImgMd" src="/documentation/svfsi/main/imgs/mesh_folder.png" style="width:100%;height:auto;max-width: 30vw;">
  <figcaption class="svCaption" >Layout of the mesh folder.</figcaption>
</figure>

**svFSI** also supports loading NURBS meshes. Limited support is available to import a bilinear quadrilateral mesh from Gambit-based ".msh". An option to convert this into a biquadratic mesh is also available. **svFSI** also supports importing mesh in the form of a list of nodal coordinates and element connectivity. It is, however, the user's responsibility to provide information on faces. The face connectivity should include a "GlobalElementID" mapping between the face element and the corresponding mesh element to which the face belongs.

We also provide a separate tool, [mesh-converter](https://github.com/SimVascular/svFSI-Tools/tree/main/mesh_converter), which can convert meshes generate by Gambit, GMSH to vtk format files. It also supports converting low-order elements to high-order elements.

Nested keywords "Add mesh" and "Add face" could be used to provide paths to the mesh and face files. The users should also provide a string-based name for each mesh and face immediately after the colon.

Multiples meshes can be loaded for the same or different equations within **svFSI**. **svFSI** supports reading multiple mesh formats as noted below. Some additional information specific to an equation may also be loaded within the mesh attribute such as domains, fiber directions, and initial values.
